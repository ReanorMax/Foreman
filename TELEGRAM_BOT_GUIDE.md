# –ì–∞–π–¥ –ø–æ Telegram –±–æ—Ç—É –¥–ª—è GitLab Webhook

–ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –∫–æ–ª–ª–µ–≥–∏ –ø–æ —Ä–∞–±–æ—Ç–µ —Å Python Telegram –±–æ—Ç–æ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ `192.168.0.159` (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞).

## üîê –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É

- **–°–µ—Ä–≤–µ—Ä**: `192.168.0.159` (—Å–µ—Ä–≤–µ—Ä —Å Telegram –±–æ—Ç–æ–º)
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `root`
- **–ü–∞—Ä–æ–ª—å**: `–í–ê–®_–ü–ê–†–û–õ–¨_–ó–î–ï–°–¨`
- **SSH –∫–æ–º–∞–Ω–¥–∞**: 
  ```bash
  ssh root@192.168.0.159
  ```

---

## üìç –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±–æ—Ç–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- **–°–∫—Ä–∏–ø—Ç –±–æ—Ç–∞**: `/usr/local/bin/git-auto-push/gitlab_webhook.py`
- **–°–µ—Ä–≤–∏—Å systemd**: `/etc/systemd/system/gitlab-webhook.service`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: `/usr/local/bin/git-auto-push/.env`
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç**: `/usr/local/bin/git-auto-push/auto_git_push.sh`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**
```
/usr/local/bin/git-auto-push/
‚îú‚îÄ‚îÄ gitlab_webhook.py    # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç Flask –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ auto_git_push.sh     # –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ push –≤ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îî‚îÄ‚îÄ .env                 # –§–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ç–æ–∫–µ–Ω—ã)
```

---

## üöÄ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –±–æ—Ç –∏ —Å–∫—Ä–∏–ø—Ç (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏)

### 1Ô∏è‚É£ gitlab_webhook.py (Flask –≤–µ–±-—Å–µ—Ä–≤–µ—Ä) - **–í–•–û–î–Ø–©–ò–ï —Å–æ–±—ã—Ç–∏—è**

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–≤–µ–¥–æ–º–ª—è–µ—Ç –æ push'–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç **—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏** –≤ GitLab.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. Flask –≤–µ–±-—Å–µ—Ä–≤–µ—Ä **–ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç** (—á–µ—Ä–µ–∑ systemd —Å–µ—Ä–≤–∏—Å `gitlab-webhook.service`)
2. –°–ª—É—à–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É `5000` endpoint `/hook` (—Ç–æ–ª—å–∫–æ POST –∑–∞–ø—Ä–æ—Å—ã)
3. GitLab —Å–µ—Ä–≤–µ—Ä (`192.168.0.20`) –Ω–∞—Å—Ç—Ä–æ–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å webhook –Ω–∞ `http://192.168.0.159:5000/hook`
4. –ö–æ–≥–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –¥–µ–ª–∞–µ—Ç `git push` –≤ GitLab:
   - GitLab –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ –±–æ—Ç
   - –ë–æ—Ç –ø–∞—Ä—Å–∏—Ç JSON —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ push
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç –∫—Ä–∞—Å–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å:
     - –ù–∞–∑–≤–∞–Ω–∏–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (—Å —Å—Å—ã–ª–∫–æ–π)
     - –ò–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫—Ç–æ —Å–¥–µ–ª–∞–ª push)
     - –í–µ—Ç–∫–æ–π, –≤ –∫–æ—Ç–æ—Ä—É—é –±—ã–ª push
     - –°–ø–∏—Å–∫–æ–º –∫–æ–º–º–∏—Ç–æ–≤ (—Å —Å—Å—ã–ª–∫–∞–º–∏)
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram —á–µ—Ä–µ–∑ Bot API

**–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:** GitLab ‚Üí Telegram (–ø–∞—Å—Å–∏–≤–Ω—ã–π, —Å–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è)

---

### 2Ô∏è‚É£ auto_git_push.sh (Bash —Å–∫—Ä–∏–ø—Ç) - **–ò–°–•–û–î–Ø–©–ò–ï push'–∏**

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞–µ—Ç push –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ **–ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤** –≤ GitLab.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é —á–µ—Ä–µ–∑ cron** (–∫–∞–∂–¥—ã–π —á–∞—Å: `0 * * * *`)
2. –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º –≤ `/home/Data/public/git_repo/`
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
   - –î–µ–ª–∞–µ—Ç `git add .` (–¥–æ–±–∞–≤–ª—è–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞
   - –ï—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:
     - –°–æ–∑–¥–∞—ë—Ç –∫–æ–º–º–∏—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º: `"Auto commit: daily update <–¥–∞—Ç–∞>"`
     - –î–µ–ª–∞–µ—Ç `git push origin main` (–ø—É—à–∏—Ç –≤ GitLab)
     - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ (‚úÖ —É—Å–ø–µ—Ö –∏–ª–∏ ‚ùå –æ—à–∏–±–∫–∞)

**–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:** –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–ø–æ ‚Üí GitLab ‚Üí Telegram (–∞–∫—Ç–∏–≤–Ω—ã–π, —Å–∞–º –¥–µ–ª–∞–µ—Ç push'–∏)

---

### üîÑ –í–∑–∞–∏–º–æ—Å–≤—è–∑—å

**–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—á–µ–≥–æ —Ü–∏–∫–ª–∞:**

1. **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –¥–µ–ª–∞–µ—Ç push –≤ GitLab:**
   - –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç `git push` –≤ GitLab —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
   - GitLab –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ `gitlab_webhook.py`
   - `gitlab_webhook.py` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram: "üöÄ Push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."

2. **–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—É—à–∞—Ç—Å—è:**
   - –ö–∞–∂–¥—ã–π —á–∞—Å cron –∑–∞–ø—É—Å–∫–∞–µ—Ç `auto_git_push.sh`
   - –°–∫—Ä–∏–ø—Ç –Ω–∞—Ö–æ–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ä–µ–ø–æ (`/home/Data/public/git_repo/`)
   - –°–∫—Ä–∏–ø—Ç –¥–µ–ª–∞–µ—Ç `git push` –≤ GitLab
   - GitLab —Å–Ω–æ–≤–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ `gitlab_webhook.py`
   - `gitlab_webhook.py` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram: "üöÄ Push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."

**–ò—Ç–æ–≥–æ:**
- **gitlab_webhook.py** - –ø–∞—Å—Å–∏–≤–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å, —Ç–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª—è–µ—Ç (GitLab ‚Üí Telegram)
- **auto_git_push.sh** - –∞–∫—Ç–∏–≤–Ω—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, –¥–µ–ª–∞–µ—Ç push'–∏ (–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–ø–æ ‚Üí GitLab), –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ç–µ–º —Ç–æ–∂–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ webhook –±–æ—Ç–∞

**–ü–æ—á–µ–º—É –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏?**
- **gitlab_webhook.py** –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ (—Å–ª—É—à–∞—Ç—å webhook'–∏)
- **auto_git_push.sh** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (–ø–æ cron, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ)
- –†–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏ = —Ä–∞–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞ = —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–í systemd unit —Ñ–∞–π–ª–µ** (`/etc/systemd/system/gitlab-webhook.service`):
```ini
Environment="TELEGRAM_BOT_TOKEN=YOUR_BOT_TOKEN_HERE"
Environment="TELEGRAM_CHAT_ID=YOUR_CHAT_ID_HERE"
```

**–í —Ñ–∞–π–ª–µ `.env`** (`/usr/local/bin/git-auto-push/.env`):
```bash
export TELEGRAM_BOT_TOKEN="YOUR_BOT_TOKEN_HERE"
export TELEGRAM_CHAT_ID="YOUR_CHAT_ID_HERE"
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** 
- –ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_BOT_TOKEN_HERE` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–ø–æ–ª—É—á–∞–µ—Ç—Å—è –æ—Ç @BotFather –≤ Telegram)
- –ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_CHAT_ID_HERE` –Ω–∞ ID —á–∞—Ç–∞/–≥—Ä—É–ø–ø—ã (—á–∏—Å–ª–æ —Å –º–∏–Ω—É—Å–æ–º –¥–ª—è –≥—Ä—É–ø–ø, –Ω–∞–ø—Ä–∏–º–µ—Ä `-1001234567890`)

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:**
1. –û—Ç–∫—Ä—ã—Ç—å Telegram
2. –ù–∞–π—Ç–∏ @BotFather
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/newbot` –∏–ª–∏ `/mybots` –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
4. –°–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
5. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω (—Ñ–æ—Ä–º–∞—Ç: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`)

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Chat ID:**
1. –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª
3. –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://api.telegram.org/bot<TOKEN>/getUpdates`
4. –ù–∞–π—Ç–∏ –≤ –æ—Ç–≤–µ—Ç–µ –ø–æ–ª–µ `"chat":{"id":-1001234567890}` - —ç—Ç–æ Chat ID

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã Python:**
- `Flask` (2.0.3) - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è webhook —Å–µ—Ä–≤–µ—Ä–∞
- `requests` (2.20.0) - HTTP –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Telegram API

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤:**
```bash
pip3 list | grep -iE "flask|requests"
```

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å):**
```bash
pip3 install Flask requests
```

---

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º

### –ß–µ—Ä–µ–∑ systemd (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
```bash
systemctl status gitlab-webhook.service
```

**–ó–∞–ø—É—Å–∫:**
```bash
systemctl start gitlab-webhook.service
```

**–û—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
systemctl stop gitlab-webhook.service
```

**–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:**
```bash
systemctl restart gitlab-webhook.service
```

**–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫:**
```bash
systemctl enable gitlab-webhook.service
```

**–û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫:**
```bash
systemctl disable gitlab-webhook.service
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø—É—â–µ–Ω –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å:**
```bash
ps aux | grep gitlab_webhook.py | grep -v grep
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–ª—É—à–∞–µ—Ç –ª–∏ –±–æ—Ç –ø–æ—Ä—Ç 5000:**
```bash
netstat -tlnp | grep 5000
# –∏–ª–∏
ss -tlnp | grep 5000
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
tcp        0      0 0.0.0.0:5000            0.0.0.0:*               LISTEN      <PID>/python3
```

---

## üìù –õ–æ–≥–∏

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ journalctl:**
```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫
journalctl -u gitlab-webhook.service -n 50 --no-pager

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
journalctl -u gitlab-webhook.service -f

# –õ–æ–≥–∏ —Å –º–æ–º–µ–Ω—Ç–∞ –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã
journalctl -u gitlab-webhook.service --since today

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
journalctl -u gitlab-webhook.service | grep -i error
```

**–¢–∏–ø–∏—á–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥–∞—Ö:**
- `192.168.0.20 - - [19/Nov/2025 21:28:58] "POST /hook HTTP/1.1" 200 -` - —É—Å–ø–µ—à–Ω—ã–π webhook (IP GitLab —Å–µ—Ä–≤–µ—Ä–∞)
- `127.0.0.1 - - [20/Nov/2025 12:25:32] "GET /hook HTTP/1.1" 405 -` - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ (GET –≤–º–µ—Å—Ç–æ POST)

---

## üîó –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook –≤ GitLab

**–ß—Ç–æ–±—ã GitLab –æ—Ç–ø—Ä–∞–≤–ª—è–ª webhook –Ω–∞ –±–æ—Ç–∞:**

1. –í–æ–π–¥–∏—Ç–µ –≤ GitLab (`http://192.168.0.20`, –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ IP –≤–∞—à–µ–≥–æ GitLab —Å–µ—Ä–≤–µ—Ä–∞)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å webhook
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Settings** ‚Üí **Webhooks**
4. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π webhook:
   - **URL**: `http://192.168.0.159:5000/hook` (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
   - **Trigger**: –í—ã–±–µ—Ä–∏—Ç–µ **Push events** (–∏–ª–∏ –¥—Ä—É–≥–∏–µ –Ω—É–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è)
   - **Secret token** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - –ù–∞–∂–º–∏—Ç–µ **Add webhook**

5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ webhook:
   - –ù–∞–∂–º–∏—Ç–µ **Test** —Ä—è–¥–æ–º —Å —Å–æ–∑–¥–∞–Ω–Ω—ã–º webhook
   - –í—ã–±–µ—Ä–∏—Ç–µ **Push events**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ Telegram –ø—Ä–∏—à–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –±–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
journalctl -u gitlab-webhook.service -f

# –í –¥—Ä—É–≥–æ–π –∫–æ–Ω—Å–æ–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π push –≤ GitLab
# –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö –∏ Telegram
```

---

## üìã –ö–æ–¥ –±–æ—Ç–∞

**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª:** `/usr/local/bin/git-auto-push/gitlab_webhook.py`

```python
from flask import Flask, request
import requests
import os

app = Flask(__name__)

BOT_TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
CHAT_ID = os.getenv("TELEGRAM_CHAT_ID")

@app.route("/hook", methods=["POST"])
def webhook():
    data = request.json

    username = data.get("user_username", "unknown")
    project = data.get("project", {})
    project_name = project.get("name", "unknown")
    project_url = project.get("web_url", "")

    ref = data.get("ref", "unknown")
    # –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å 'refs/heads/'
    branch_name = ref.replace("refs/heads/", "") if ref != "unknown" else "unknown"

    commits = data.get("commits", [])

    commit_messages = "\n".join([
        f"- [{c['message'].strip()}]({c['url']})" for c in commits
    ])

    text = (
        f"üöÄ *Push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:* [{project_name}]({project_url})\n"
        f"üë§ *–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:* `{username}`\n"
        f"üåø *–í–µ—Ç–∫–∞:* `{branch_name}`\n"
        f"üìú *–ö–æ–º–º–∏—Ç—ã:*\n{commit_messages}"
    )

    requests.post(
        f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage",  
        json={"chat_id": CHAT_ID, "text": text, "parse_mode": "Markdown"},
    )

    return "OK"

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞—ë—Ç HTTP —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 5000
2. Endpoint `/hook` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ POST –∑–∞–ø—Ä–æ—Å—ã
3. –ü–∞—Ä—Å–∏—Ç JSON –æ—Ç GitLab webhook
4. –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ, –ø—Ä–æ–µ–∫—Ç–µ, –≤–µ—Ç–∫–µ, –∫–æ–º–º–∏—Ç–∞—Ö
5. –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown
6. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram —á–µ—Ä–µ–∑ Bot API
7. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç "OK" GitLab'—É

---

## üîß Systemd Unit —Ñ–∞–π–ª

**–§–∞–π–ª:** `/etc/systemd/system/gitlab-webhook.service`

```ini
[Unit]
Description=GitLab Webhook Telegram Bot
After=network.target

[Service]
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Å–µ—Ä–≤–∏—Å
User=root

# –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è (–≥–¥–µ –ª–µ–∂–∏—Ç —Å–∫—Ä–∏–ø—Ç)
WorkingDirectory=/usr/local/bin/git-auto-push

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
ExecStart=/usr/bin/python3 /usr/local/bin/git-auto-push/gitlab_webhook.py

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
Environment="TELEGRAM_BOT_TOKEN=YOUR_BOT_TOKEN_HERE"
Environment="TELEGRAM_CHAT_ID=YOUR_CHAT_ID_HERE"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
Restart=always
RestartSec=10s

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=gitlab-webhook

[Install]
WantedBy=multi-user.target
```

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è unit —Ñ–∞–π–ª–∞:**
```bash
# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å systemd
systemctl daemon-reload

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
systemctl restart gitlab-webhook.service
```

---

## üîÑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç auto_git_push.sh (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `/usr/local/bin/git-auto-push/auto_git_push.sh`

**–¢–µ–∫—É—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ cron:**
```bash
# –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π —á–∞—Å (–≤ 0 –º–∏–Ω—É—Ç –∫–∞–∂–¥–æ–≥–æ —á–∞—Å–∞)
0 * * * * /usr/local/bin/git-auto-push/auto_git_push.sh >> /var/log/git-auto-push.log 2>&1
```

**–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:**
- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: `/home/Data/public/git_repo/`
- –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤: `ksu-4-web-centos`, `ksu-8-web-debian`, `ksu-asterisk-centos` –∏ —Ç.–¥.
- –í—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å

**–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –≤—Ä—É—á–Ω—É—é:**
```bash
# –í—Ä—É—á–Ω—É—é (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
bash /usr/local/bin/git-auto-push/auto_git_push.sh

# –°–¥–µ–ª–∞—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
chmod +x /usr/local/bin/git-auto-push/auto_git_push.sh
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ cron:**
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏ cron
crontab -l

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å crontab
crontab -e

# –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π:
# –ö–∞–∂–¥—ã–π —á–∞—Å:       0 * * * *
# –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç:  */30 * * * *
# –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00: 0 2 * * *
# –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç:  */15 * * * *
```

**–õ–æ–≥–∏ —Å–∫—Ä–∏–ø—Ç–∞:**
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
tail -f /var/log/git-auto-push.log

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏
tail -50 /var/log/git-auto-push.log
```

---

## ‚ùå –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
systemctl status gitlab-webhook.service

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
journalctl -u gitlab-webhook.service -n 50

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip3 list | grep -iE "flask|requests"

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
ls -la /usr/local/bin/git-auto-push/gitlab_webhook.py
```

**–†–µ—à–µ–Ω–∏–µ:**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `pip3 install Flask requests`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –∏ Chat ID –≤ unit —Ñ–∞–π–ª–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É

### –ë–æ—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç webhook –æ—Ç GitLab

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–ª—É—à–∞–µ—Ç –ª–∏ –ø–æ—Ä—Ç 5000
netstat -tlnp | grep 5000

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
journalctl -u gitlab-webhook.service -f

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏–∑–≤–Ω–µ
curl -X POST http://192.168.0.159:5000/hook -H "Content-Type: application/json" -d '{"test":"data"}'
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall –ø—Ä–∞–≤–∏–ª–∞ (–ø–æ—Ä—Ç 5000 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook –≤ GitLab (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL)

### –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Telegram

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ unit —Ñ–∞–π–ª–µ
systemctl cat gitlab-webhook.service | grep TELEGRAM_BOT_TOKEN

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Chat ID
systemctl cat gitlab-webhook.service | grep TELEGRAM_CHAT_ID

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
journalctl -u gitlab-webhook.service | grep -i error
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—á–µ—Ä–µ–∑ @BotFather)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Chat ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–¥–ª—è –≥—Ä—É–ø–ø —Å –º–∏–Ω—É—Å–æ–º)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ (–º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è)

### –û—à–∏–±–∫–∞ "405 Method Not Allowed"

**–ü—Ä–∏—á–∏–Ω–∞:**
Webhook endpoint –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ POST –∑–∞–ø—Ä–æ—Å—ã, –∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç GET.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook –≤ GitLab (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å POST)
- –ù–µ –ø—ã—Ç–∞—Ç—å—Å—è –æ—Ç–∫—Ä—ã–≤–∞—Ç—å URL –≤ –±—Ä–∞—É–∑–µ—Ä–µ (—ç—Ç–æ GET –∑–∞–ø—Ä–æ—Å)

### –ë–æ—Ç –ø–∞–¥–∞–µ—Ç –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
journalctl -u gitlab-webhook.service | grep -i error
journalctl -u gitlab-webhook.service | grep -i exception
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Python –∫–æ–¥–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ç–∏ (–¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –∏ Chat ID

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**‚ö†Ô∏è –í–ê–ñ–ù–û:**
1. –¢–æ–∫–µ–Ω –±–æ—Ç–∞ - —ç—Ç–æ —Å–µ–∫—Ä–µ—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è! –ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ –µ–≥–æ –≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö
2. –§–∞–π–ª `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–∫–µ–Ω—ã - –æ–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –Ω–µ–º—É:
   ```bash
   chmod 600 /usr/local/bin/git-auto-push/.env
   ```
3. Unit —Ñ–∞–π–ª systemd —Ç–∞–∫–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–∫–µ–Ω—ã - –æ–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø:
   ```bash
   chmod 644 /etc/systemd/system/gitlab-webhook.service
   ```
4. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è secret token –≤ GitLab webhook –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
5. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç—É 5000 —á–µ—Ä–µ–∑ firewall (—Ç–æ–ª—å–∫–æ —Å GitLab —Å–µ—Ä–≤–µ—Ä–∞)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ root) –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall –ø—Ä–∞–≤–∏–ª–∞
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
systemctl status gitlab-webhook.service

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ webhook –∑–∞–ø—Ä–æ—Å—ã
journalctl -u gitlab-webhook.service -n 20 --no-pager | grep "POST /hook"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
ps aux | grep gitlab_webhook.py | grep -v grep
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Å–∫—Ä–∏–ø—Ç):**
```bash
#!/bin/bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
if systemctl is-active --quiet gitlab-webhook.service; then
    echo "‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç"
else
    echo "‚ùå –ë–æ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!"
    systemctl restart gitlab-webhook.service
fi
```

---

## üìû –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–µ–ª

**–ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –¥–ª—è –∫–æ–ª–ª–µ–≥–∏:**
- **–°–µ—Ä–≤–µ—Ä**: `192.168.0.159` (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
- **–°–∫—Ä–∏–ø—Ç**: `/usr/local/bin/git-auto-push/gitlab_webhook.py`
- **–°–µ—Ä–≤–∏—Å**: `gitlab-webhook.service`
- **–ü–æ—Ä—Ç**: `5000`
- **Webhook URL**: `http://192.168.0.159:5000/hook` (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
- **GitLab —Å–µ—Ä–≤–µ—Ä**: `192.168.0.20` (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ IP –≤–∞—à–µ–≥–æ GitLab —Å–µ—Ä–≤–µ—Ä–∞)
- **–õ–æ–≥–∏**: `journalctl -u gitlab-webhook.service`

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –∫–æ–ª–ª–µ–≥–µ:**
1. ‚úÖ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞ (`systemctl status gitlab-webhook.service`)
2. ‚úÖ –ö–∞–∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ (`systemctl restart gitlab-webhook.service`)
3. ‚úÖ –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ (`journalctl -u gitlab-webhook.service -f`)
4. ‚úÖ –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–∫–µ–Ω—ã (unit —Ñ–∞–π–ª –∏ .env)
5. ‚úÖ –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –≤ GitLab (Settings ‚Üí Webhooks)
6. ‚úÖ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É (—Å–¥–µ–ª–∞—Ç—å push –≤ GitLab –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram)

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –∫–æ–ª–ª–µ–≥–∏

–ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –¥–µ–ª –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (`systemctl status gitlab-webhook.service`)
- [ ] –ü–æ—Ä—Ç 5000 —Å–ª—É—à–∞–µ—Ç—Å—è (`netstat -tlnp | grep 5000`)
- [ ] Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ GitLab (`http://192.168.0.20` ‚Üí Settings ‚Üí Webhooks, –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ IP –≤–∞—à–µ–≥–æ GitLab)
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Telegram –ø—Ä–∏ push –≤ GitLab
- [ ] –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∏ –Ω–µ—Ç –æ—à–∏–±–æ–∫ (`journalctl -u gitlab-webhook.service`)
- [ ] –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –≤–∫–ª—é—á–µ–Ω (`systemctl is-enabled gitlab-webhook.service`)
- [ ] –¢–æ–∫–µ–Ω –±–æ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
- [ ] –ó–Ω–∞–µ—Ç–µ, –∫–∞–∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
- [ ] –ó–Ω–∞–µ—Ç–µ, –≥–¥–µ –ª–æ–≥–∏
- [ ] –ó–Ω–∞–µ—Ç–µ, –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ—á–∏—Ç–∞–Ω–∞ –∏ –ø–æ–Ω—è—Ç–Ω–∞

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-20
