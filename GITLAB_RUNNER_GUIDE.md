# –ì–∞–π–¥ –ø–æ GitLab Runner

–ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –∫–æ–ª–ª–µ–≥–∏ –ø–æ —Ä–∞–±–æ—Ç–µ —Å GitLab Runner –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ `10.19.1.108`.

## üìö –ß—Ç–æ —Ç–∞–∫–æ–µ GitLab Runner?

**GitLab Runner** ‚Äî —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç CI/CD –∑–∞–¥–∞—á–∏ (jobs) –∏–∑ GitLab CI/CD pipeline. 

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è:

- **Runner** ‚Äî —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç CI/CD –∑–∞–¥–∞—á–∏
- **Job** ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ –≤ pipeline (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–±–æ—Ä–∫–∞, —Ç–µ—Å—Ç, –¥–µ–ø–ª–æ–π)
- **Pipeline** ‚Äî –Ω–∞–±–æ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤ `.gitlab-ci.yml`
- **Executor** ‚Äî —Å–ø–æ—Å–æ–± –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á (Docker, Shell, Kubernetes –∏ —Ç.–¥.)

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø—É—à–∏—Ç –∫–æ–¥ –≤ GitLab
2. GitLab –∑–∞–ø—É—Å–∫–∞–µ—Ç pipeline (–∑–∞–¥–∞—á–∏ –∏–∑ `.gitlab-ci.yml`)
3. Runner –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏—Ö
4. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ GitLab

---

## üîê –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É

- **–°–µ—Ä–≤–µ—Ä**: `10.19.1.108`
- **–•–æ—Å—Ç**: `foreman.example.com`
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `root`
- **–ü–∞—Ä–æ–ª—å**: `foreman`
- **SSH –∫–æ–º–∞–Ω–¥–∞**: 
  ```bash
  ssh root@10.19.1.108
  ```

---

## üìä –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Runner'–µ

- **–í–µ—Ä—Å–∏—è**: `18.2.1`
- **GitLab —Å–µ—Ä–≤–µ—Ä**: `http://10.19.1.20`
- **–°—Ç–∞—Ç—É—Å**: –ê–∫—Ç–∏–≤–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **Executor**: Docker

### –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ Runner'—ã

#### 1. docker-runner

- **ID**: `0`
- **–ò–º—è**: `docker-runner`
- **Token**: `it5dxYzJNCwzkLvgT8gk`
- **Executor**: `docker`
- **Docker Image**: `alpine:latest`
- **Privileged**: `true`
- **–ü—Ä–æ–µ–∫—Ç**: `Automatization/ansible` (ID: 89)
- **URL**: `http://10.19.1.20`

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Docker:**
- Volumes: `/var/run/docker.sock:/var/run/docker.sock`, `/cache`
- Pull policy: `if-not-present`
- TLS verify: `false`

#### 2. pbx-iac-runner

- **ID**: `15`
- **–ò–º—è**: `pbx-iac-runner`
- **Token**: `s26Ffck-UJny--FV5e1V`
- **Executor**: `docker`
- **Docker Image**: `alpine:latest`
- **Privileged**: `true`
- **URL**: `http://10.19.1.20`

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Docker:**
- Volumes: `/var/run/docker.sock:/var/run/docker.sock`, `/cache`
- Pull policy: `if-not-present`
- TLS verify: `false`

---

## üöÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ GitLab Runner

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
systemctl status gitlab-runner

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é
gitlab-runner --version

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö runner'–æ–≤
gitlab-runner list

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GitLab
gitlab-runner verify
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ `gitlab-runner verify`:**
```
Verifying runner... is alive  runner=it5dxYzJN
Verifying runner... is alive  runner=s26Ffck-U
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Runner'–∞

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
systemctl restart gitlab-runner

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å
systemctl stop gitlab-runner

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
systemctl start gitlab-runner

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
gitlab-runner restart
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ª–æ–≥–æ–≤
journalctl -u gitlab-runner -n 50

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
journalctl -u gitlab-runner -f

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
journalctl -u gitlab-runner | grep -i error
journalctl -u gitlab-runner | grep "WARNING: Job failed"
```

---

## üìã –ß—Ç–æ –¥–µ–ª–∞–µ—Ç Runner

### –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏

Runner –≤—ã–ø–æ–ª–Ω—è–µ—Ç CI/CD –∑–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ **Automatization/ansible** (ID: 89).

**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
- Job ID: 2834, 2835, 2836 (–≤—Å–µ –ø–∞–¥–∞–ª–∏ —Å –æ—à–∏–±–∫–æ–π `exit code 1`)
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `http://10.19.1.20/Automatization/ansible.git`
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ~90 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–¥–∞—á—É
- –°—Ç–∞—Ç—É—Å: Job –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, –Ω–æ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è —Å –æ—à–∏–±–∫–∞–º–∏

### –ü—Ä–æ–µ–∫—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ Runner

1. **Automatization/ansible** (Project ID: 89)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç runner: `docker-runner`
   - –ü–æ—Å–ª–µ–¥–Ω–∏–µ job'—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, –Ω–æ –ø–∞–¥–∞—é—Ç —Å –æ—à–∏–±–∫–∞–º–∏

2. **PBX IAC –ø—Ä–æ–µ–∫—Ç—ã**
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç runner: `pbx-iac-runner`

### –¢–∏–ø–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ CI/CD:

1. **–°–±–æ—Ä–∫–∞** (Build)
   - –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∫–æ–¥–∞
   - –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (Test)
   - –ó–∞–ø—É—Å–∫ unit-—Ç–µ—Å—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞

3. **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** (Deploy)
   - –ó–∞–ø—É—Å–∫ Ansible playbook'–æ–≤
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Runner'–∞

### –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `/etc/gitlab-runner/config.toml`

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```toml
concurrent = 1                    # –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á
check_interval = 0                # –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á (0 = –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)

[[runners]]
  name = "docker-runner"
  url = "http://10.19.1.20"
  token = "it5dxYzJNCwzkLvgT8gk"
  executor = "docker"
  [runners.docker]
    image = "alpine:latest"
    privileged = true
    volumes = ["/var/run/docker.sock:/var/run/docker.sock", "/cache"]

[[runners]]
  name = "pbx-iac-runner"
  url = "http://10.19.1.20"
  token = "s26Ffck-UJny--FV5e1V"
  executor = "docker"
  [runners.docker]
    image = "alpine:latest"
    privileged = true
    volumes = ["/var/run/docker.sock:/var/run/docker.sock", "/cache"]
```

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nano /etc/gitlab-runner/config.toml
# –∏–ª–∏
vi /etc/gitlab-runner/config.toml

# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
gitlab-runner restart
# –∏–ª–∏
systemctl restart gitlab-runner
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ runner!

---

## üê≥ Docker –∏ Runner

### –°—Ç–∞—Ç—É—Å Docker

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Docker
systemctl status docker

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é
docker --version

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–≤–∫–ª—é—á–∞—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ)
docker ps -a
```

### Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ Runner'–æ–º

Runner —Å–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Runner'–∞:**
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker ps | grep gitlab-runner

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–≤–∫–ª—é—á–∞—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ)
docker ps -a | grep gitlab-runner
```

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ Runner'–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ runner –∞–∫—Ç–∏–≤–µ–Ω
gitlab-runner verify

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ runner'–æ–≤
gitlab-runner list

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
systemctl status gitlab-runner --no-pager
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–¥–∞—á

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–¥–∞—á
journalctl -u gitlab-runner -n 100 | grep -E "job=|Checking for jobs"

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
journalctl -u gitlab-runner | grep "WARNING: Job failed"

# –ü—Ä–æ—Å–º–æ—Ç—Ä —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–¥–∞—á
journalctl -u gitlab-runner | grep "Job succeeded"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU/–ø–∞–º—è—Ç–∏
top -p $(pgrep gitlab-runner)

# –ò–ª–∏ —á–µ—Ä–µ–∑ htop
htop -p $(pgrep gitlab-runner)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h /home/gitlab-runner
```

---

## ‚ùå –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. Runner –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞—á–∏

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö –Ω–µ—Ç "Checking for jobs"
- –í GitLab –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "Runner offline"

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
systemctl status gitlab-runner

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GitLab
gitlab-runner verify

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
gitlab-runner list

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å runner
systemctl restart gitlab-runner

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
journalctl -u gitlab-runner -n 50
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- Runner –Ω–µ –∑–∞–ø—É—â–µ–Ω
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç–µ–≤—ã–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ GitLab
- Runner –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –¥–ª—è –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

---

### 2. –ó–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, –Ω–æ –ø–∞–¥–∞—é—Ç —Å –æ—à–∏–±–∫–∞–º–∏

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `WARNING: Job failed: exit code 1`
- –ó–∞–¥–∞—á–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è, –Ω–æ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# 1. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∑–∞–¥–∞—á–∏
journalctl -u gitlab-runner | grep -A 20 "job=<JOB_ID>"

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ GitLab
# –ü–µ—Ä–µ–π—Ç–∏ –≤ GitLab ‚Üí –ü—Ä–æ–µ–∫—Ç ‚Üí CI/CD ‚Üí Pipelines ‚Üí –í—ã–±—Ä–∞—Ç—å pipeline ‚Üí Job

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker –æ–±—Ä–∞–∑
docker pull alpine:latest

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Docker socket
ls -la /var/run/docker.sock
```

**–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –û—à–∏–±–∫–∏ –≤ CI/CD —Å–∫—Ä–∏–ø—Ç–∞—Ö (`.gitlab-ci.yml`)
- –ü—Ä–æ–±–ª–µ–º—ã —Å Docker –æ–±—Ä–∞–∑–æ–º
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

**–ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –∑–∞–¥–∞—á–∏ –≤ GitLab:**
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ GitLab
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ **CI/CD ‚Üí Pipelines**
3. –í—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–π pipeline
4. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —É–ø–∞–≤—à—É—é –∑–∞–¥–∞—á—É (job)
5. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

### 3. Docker –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∏: `Cannot connect to the Docker daemon`
- Runner –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Docker
systemctl status docker

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Docker
systemctl start docker

# 3. –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
systemctl enable docker

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
ls -la /var/run/docker.sock
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: srw-rw---- 1 root docker

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å gitlab-runner –≤ –≥—Ä—É–ø–ø–µ docker
groups gitlab-runner
# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≥—Ä—É–ø–ø–∞: docker

# –ï—Å–ª–∏ –Ω–µ—Ç - –¥–æ–±–∞–≤–∏—Ç—å:
usermod -aG docker gitlab-runner
systemctl restart gitlab-runner
```

---

### 4. Runner –Ω–µ –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å Docker –æ–±—Ä–∞–∑

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∏: `pull access denied` –∏–ª–∏ `image not found`

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–±—Ä–∞–∑–∞
docker pull alpine:latest

# 2. –ï—Å–ª–∏ –æ–±—Ä–∞–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å /etc/gitlab-runner/config.toml
# –ò–∑–º–µ–Ω–∏—Ç—å image = "alpine:latest" –Ω–∞ –¥—Ä—É–≥–æ–π –æ–±—Ä–∞–∑

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å runner
systemctl restart gitlab-runner
```

---

### 5. Runner –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "offline" –≤ GitLab

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í GitLab Runner –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "offline"
- –ù–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ runner –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ runner –∑–∞–ø—É—â–µ–Ω
systemctl status gitlab-runner

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GitLab
gitlab-runner verify

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç—å
ping 10.19.1.20

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cat /etc/gitlab-runner/config.toml | grep token

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å runner
systemctl restart gitlab-runner

# 6. –í GitLab –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ runner'–∞
# GitLab ‚Üí Settings ‚Üí CI/CD ‚Üí Runners ‚Üí –ù–∞–π—Ç–∏ runner ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

---

## üîÑ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ Runner'–∞

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π runner:

```bash
# –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π runner
gitlab-runner register

# –ë—É–¥–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
# - GitLab URL: http://10.19.1.20
# - Registration token: (–ø–æ–ª—É—á–∏—Ç—å –≤ GitLab ‚Üí Settings ‚Üí CI/CD ‚Üí Runners ‚Üí Registration token)
# - Description: –Ω–∞–∑–≤–∞–Ω–∏–µ runner'–∞
# - Tags: —Ç–µ–≥–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ runner'–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# - Executor: docker
# - Docker image: alpine:latest (–∏–ª–∏ –¥—Ä—É–≥–æ–π)
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ Registration Token:**
1. –ó–∞–π—Ç–∏ –≤ GitLab: `http://10.19.1.20`
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≥—Ä—É–ø–ø—É
3. **Settings ‚Üí CI/CD ‚Üí Runners**
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å **Registration token**

---

## üìÅ –†–∞–±–æ—á–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

### –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `/home/gitlab-runner/`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
/home/gitlab-runner/
‚îú‚îÄ‚îÄ builds/              # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ .ansible/           # Ansible –∫—ç—à –∏ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ .cache/             # –ö—ç—à
‚îú‚îÄ‚îÄ .docker/            # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ .git-credentials    # Git credentials
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
du -sh /home/gitlab-runner/

# –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —Å–±–æ—Ä–∫–∏ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
cd /home/gitlab-runner/builds
rm -rf */  # –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–±–æ—Ä–∫–∏
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –¢–æ–∫–µ–Ω—ã Runner'–∞

–¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `/etc/gitlab-runner/config.toml`

**–¢–µ–∫—É—â–∏–µ —Ç–æ–∫–µ–Ω—ã:**
- `docker-runner`: `it5dxYzJNCwzkLvgT8gk`
- `pbx-iac-runner`: `s26Ffck-UJny--FV5e1V`

**‚ö†Ô∏è –í–ê–ñ–ù–û:** 
- –ù–µ –¥–µ–ª–∏—Ç–µ—Å—å —Ç–æ–∫–µ–Ω–∞–º–∏ –ø—É–±–ª–∏—á–Ω–æ
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω - —Å–±—Ä–æ—Å—å—Ç–µ –µ–≥–æ –≤ GitLab

**–°–±—Ä–æ—Å —Ç–æ–∫–µ–Ω–∞:**
1. –í GitLab: **Settings ‚Üí CI/CD ‚Üí Runners**
2. –ù–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π runner
3. –ù–∞–∂–∞—Ç—å **Reset token**
4. –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ `/etc/gitlab-runner/config.toml`
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å runner

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ GitLab

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ Runner'–∞ –≤ GitLab

1. –ó–∞–π—Ç–∏ –≤ GitLab: `http://10.19.1.20`
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ **Admin Area ‚Üí Overview ‚Üí Runners** (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
3. –ò–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ: **Settings ‚Üí CI/CD ‚Üí Runners**

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ runner'–µ:**
- **Status**: online/offline
- **Last contact**: –∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –ø–æ–¥–∫–ª—é—á–∞–ª—Å—è
- **Projects**: –∫–∞–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç runner
- **Jobs**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

### –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç –≤ GitLab
2. **CI/CD ‚Üí Pipelines**
3. –í—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–π pipeline
4. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏ (jobs)

---

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é
gitlab-runner --version

# –°–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö runner'–æ–≤
gitlab-runner list

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
gitlab-runner verify

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å runner
gitlab-runner restart

# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
systemctl status gitlab-runner

# –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏
journalctl -u gitlab-runner -f

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker
docker ps
docker images

# –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ Docker —Ä–µ—Å—É—Ä—Å—ã
docker system prune -a
```

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–µ–ª

–ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –¥–µ–ª –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] Runner –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (`systemctl status gitlab-runner`)
- [ ] Runner –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ GitLab (`gitlab-runner verify`)
- [ ] Docker –∑–∞–ø—É—â–µ–Ω (`systemctl status docker`)
- [ ] –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
- [ ] –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∏ –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- [ ] –ó–Ω–∞–µ—Ç–µ, –∫–∞–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç runner'—ã
- [ ] –ó–Ω–∞–µ—Ç–µ, –∫–∞–∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å runner
- [ ] –ó–Ω–∞–µ—Ç–µ, –≥–¥–µ –ª–æ–≥–∏
- [ ] –ó–Ω–∞–µ—Ç–µ, –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á –≤ GitLab
- [ ] –ó–Ω–∞–µ—Ç–µ, –≥–¥–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`/etc/gitlab-runner/config.toml`)

---

## üìû –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **GitLab Runner –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://docs.gitlab.com/runner/
- **GitLab CI/CD –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://docs.gitlab.com/ee/ci/
- **Docker –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://docs.docker.com/

---

**‚ö†Ô∏è –í–ê–ñ–ù–û: –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —á–µ—Ä–µ–∑ `journalctl -u gitlab-runner` –∏ –ª–æ–≥–∏ –≤ GitLab (CI/CD ‚Üí Pipelines)!**

